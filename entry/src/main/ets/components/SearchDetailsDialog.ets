/**
 * æœç´¢è¯¦æƒ…å¼¹æ¡†ç»„ä»¶
 * æ”¯æŒå†…å®¹é€‰ä¸­å¤åˆ¶åŠŸèƒ½
 */
import { Logger } from '../utils/Logger';
import { pasteboard } from '@kit.BasicServicesKit';
import { promptAction } from '@kit.ArkUI';

@ComponentV2
export struct SearchDetailsDialog {
  @Param isVisible: boolean = false;
  @Param content: string = '';
  @Param onClose: () => void = () => {};

  aboutToAppear() {
    Logger.info('SearchDetailsDialog', `å¼¹æ¡†çŠ¶æ€: ${this.isVisible}, å†…å®¹é•¿åº¦: ${this.content?.length || 0}`);
  }

  build() {
    if (this.isVisible) {
      // åŠé€æ˜èƒŒæ™¯é®ç½©
      Stack() {
        // èƒŒæ™¯é®ç½©
        Column()
          .width('100%')
          .height('100%')
          .backgroundColor('rgba(0, 0, 0, 0.5)')
          .onClick(() => {
            this.onClose();
          })

        // å¼¹æ¡†å†…å®¹
        Column() {
          // æ ‡é¢˜æ 
          Row() {
            Text('ğŸ” ç½‘ç»œæœç´¢è¯¦æƒ…')
              .fontSize(16)
              .fontWeight(FontWeight.Medium)
              .fontColor('#333333')
            Blank()
            Button() {
              Text('âœ•')
                .fontSize(14)
                .fontColor('#666666')
            }
            .width(32)
            .height(32)
            .backgroundColor(Color.Transparent)
            .borderRadius(16)
            .onClick(() => {
              this.onClose();
            })
          }
          .width('100%')
          .margin({ bottom: 16 })

          Divider()
            .strokeWidth(1)
            .color('#E0E0E0')
            .margin({ bottom: 16 })

          // å¯é€‰ä¸­çš„å†…å®¹åŒºåŸŸ
          Scroll() {
            Column() {
              Text(this.content)
                .fontSize(14)
                .fontColor('#333333')
                .textAlign(TextAlign.Start)
                .width('100%')
                .lineHeight(20)
                .padding(12)
                .backgroundColor('#F8F9FA')
                .borderRadius(8)
            }
            .width('100%')
          }
          .scrollBar(BarState.On)
          .scrollBarColor('#999999')
          .scrollBarWidth(8)
          .edgeEffect(EdgeEffect.Spring)
          .constraintSize({ maxHeight: 400 })

          // æŒ‰é’®åŒºåŸŸ
          Row() {
            Button() {
              Text('å…¨é€‰å¤åˆ¶')
                .fontSize(14)
                .fontColor(Color.White)
            }
            .width(80)
            .height(36)
            .backgroundColor('#4285F4')
            .borderRadius(18)
            .onClick(() => {
              this.copyAllContent();
            })

            Blank()

            Button() {
              Text('å…³é—­')
                .fontSize(14)
                .fontColor('#666666')
            }
            .width(80)
            .height(36)
            .backgroundColor('#F0F0F0')
            .borderRadius(18)
            .onClick(() => {
              this.onClose();
            })
          }
          .width('100%')
          .margin({ top: 16 })
        }
        .width('90%')
        .constraintSize({ maxWidth: 500 })
        .backgroundColor(Color.White)
        .borderRadius(16)
        .padding(20)
        .shadow({
          radius: 12,
          color: 'rgba(0, 0, 0, 0.2)',
          offsetX: 0,
          offsetY: 8
        })
      }
      .width('100%')
      .height('100%')
      .position({ x: 0, y: 0 })
      .zIndex(1000)
    }
  }

  /**
   * å¤åˆ¶å…¨éƒ¨å†…å®¹
   */
  private copyAllContent(): void {
    if (this.content) {
      const pasteData = pasteboard.createData(pasteboard.MIMETYPE_TEXT_PLAIN, this.content);
      const systemPasteboard = pasteboard.getSystemPasteboard();
      systemPasteboard.setData(pasteData);
      
      promptAction.showToast({
        message: 'æœç´¢ä¿¡æ¯å·²å¤åˆ¶',
        duration: 1000
      });
      Logger.info('SearchDetailsDialog', 'å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
    }
  }
}