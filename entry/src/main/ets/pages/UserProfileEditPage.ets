import { router } from '@kit.ArkUI';
import { picker } from '@kit.CoreFileKit';
import { UserProfile, UserProfileData } from '../utils/AppStorage';
import { UserProfileManager } from '../utils/UserProfileManager';
import { Logger } from '../utils/Logger';

interface AvatarOption {
  text: string;
  value: string;
}

/**
 * ç”¨æˆ·èµ„æ–™ç¼–è¾‘é¡µé¢
 */
@Entry
@ComponentV2
struct UserProfileEditPage {
  @Local userName: string = '';
  @Local userSignature: string = '';
  @Local userAvatarType: 'default' | 'emoji' | 'image' = 'default';
  @Local userAvatarValue: string = '#4285F4';
  @Local statusBarHeight: number = 44;
  @Local hasChanges: boolean = false; // æ˜¯å¦æœ‰æœªä¿å­˜çš„æ›´æ”¹
  @Local isSaving: boolean = false; // æ˜¯å¦æ­£åœ¨ä¿å­˜
  @Local validationErrors: string[] = []; // éªŒè¯é”™è¯¯ä¿¡æ¯
  @Local screenWidth: number = 0; // å±å¹•å®½åº¦
  @Local isCompactScreen: boolean = false; // æ˜¯å¦ä¸ºç´§å‡‘å±å¹•
  
  // è®¾è®¡ç³»ç»Ÿ - é—´è·tokens (åŸºäº8pxç½‘æ ¼)
  private readonly SPACING_XS: number = 4;    // è¶…å°é—´è·
  private readonly SPACING_SM: number = 8;    // å°é—´è·
  private readonly SPACING_MD: number = 12;   // ä¸­ç­‰é—´è·
  private readonly SPACING_LG: number = 16;   // å¤§é—´è·
  private readonly SPACING_XL: number = 20;   // è¶…å¤§é—´è·
  private readonly SPACING_XXL: number = 24;  // å·¨å¤§é—´è·
  private readonly SPACING_XXXL: number = 32; // æœ€å¤§é—´è·
  
  // ç»„ä»¶å°ºå¯¸tokens
  private readonly SIZE_AVATAR: number = 72;        // å¤´åƒå°ºå¯¸
  private readonly SIZE_INPUT_HEIGHT: number = 44;   // è¾“å…¥æ¡†é«˜åº¦
  private readonly SIZE_TEXTAREA_HEIGHT: number = 72; // å¤šè¡Œæ–‡æœ¬è¾“å…¥æ¡†é«˜åº¦
  private readonly SIZE_BUTTON_HEIGHT: number = 44;  // æŒ‰é’®é«˜åº¦
  private readonly SIZE_NAV_HEIGHT: number = 48;     // å¯¼èˆªæ é«˜åº¦
  
  // è¾¹æ¡†åœ†è§’tokens
  private readonly RADIUS_SM: number = 6;   // å°åœ†è§’
  private readonly RADIUS_MD: number = 8;   // ä¸­ç­‰åœ†è§’
  private readonly RADIUS_LG: number = 12;  // å¤§åœ†è§’
  private readonly RADIUS_XL: number = 16;  // è¶…å¤§åœ†è§’
  
  private userProfileManager: UserProfileManager = UserProfileManager.getInstance();
  private originalProfile: UserProfile | null = null; // åŸå§‹èµ„æ–™ï¼Œç”¨äºæ¯”è¾ƒæ˜¯å¦æœ‰æ›´æ”¹

  async aboutToAppear(): Promise<void> {
    Logger.info('UserProfileEditPage', 'aboutToAppear');
    
    try {
      // åˆå§‹åŒ–ç”¨æˆ·èµ„æ–™ç®¡ç†å™¨
      await this.userProfileManager.initialize();
      
      // åŠ è½½å½“å‰ç”¨æˆ·èµ„æ–™
      const currentProfile = this.userProfileManager.getCurrentProfile();
      if (currentProfile) {
        this.originalProfile = currentProfile.clone();
        this.userName = currentProfile.userName;
        this.userSignature = currentProfile.userSignature;
        this.userAvatarType = currentProfile.userAvatarType;
        this.userAvatarValue = currentProfile.userAvatarValue;
        Logger.info('UserProfileEditPage', `åŠ è½½ç”¨æˆ·èµ„æ–™: ${this.userName}`);
      }
      
      // åˆå§‹åŒ–å“åº”å¼è®¾è®¡
      this.initResponsiveDesign();
    } catch (error) {
      Logger.error('UserProfileEditPage', `åˆå§‹åŒ–å¤±è´¥: ${error}`);
    }
  }
  
  /**
   * åˆå§‹åŒ–å“åº”å¼è®¾è®¡
   */
  private initResponsiveDesign(): void {
    // è¿™é‡Œå¯ä»¥æ ¹æ®å®é™…éœ€è¦è®¾ç½®å±å¹•å®½åº¦æ£€æµ‹
    // ç›®å‰ä½¿ç”¨é»˜è®¤å€¼ï¼Œåœ¨å®é™…åº”ç”¨ä¸­å¯ä»¥é€šè¿‡ç³»ç»Ÿ API è·å–
    this.screenWidth = 360; // é»˜è®¤å®½åº¦
    this.isCompactScreen = this.screenWidth < 400;
  }
  
  /**
   * è·å–å“åº”å¼é—´è·
   */
  private getResponsiveSpacing(baseSpacing: number): number {
    return this.isCompactScreen ? Math.max(baseSpacing - 4, 4) : baseSpacing;
  }
  
  /**
   * è·å–å“åº”å¼å°ºå¯¸
   */
  private getResponsiveSize(baseSize: number): number {
    return this.isCompactScreen ? Math.max(baseSize - 8, baseSize * 0.8) : baseSize;
  }
  
  /**
   * è·å–é—´è·å€¼
   */
  private getSpacing(type: 'xs' | 'sm' | 'md' | 'lg' | 'xl' | 'xxl' | 'xxxl'): number {
    switch (type) {
      case 'xs': return this.SPACING_XS;
      case 'sm': return this.SPACING_SM;
      case 'md': return this.SPACING_MD;
      case 'lg': return this.SPACING_LG;
      case 'xl': return this.SPACING_XL;
      case 'xxl': return this.SPACING_XXL;
      case 'xxxl': return this.SPACING_XXXL;
      default: return this.SPACING_MD;
    }
  }
  
  /**
   * è·å–å°ºå¯¸å€¼
   */
  private getSize(type: 'avatar' | 'inputHeight' | 'textAreaHeight' | 'buttonHeight' | 'navHeight'): number {
    switch (type) {
      case 'avatar': return this.SIZE_AVATAR;
      case 'inputHeight': return this.SIZE_INPUT_HEIGHT;
      case 'textAreaHeight': return this.SIZE_TEXTAREA_HEIGHT;
      case 'buttonHeight': return this.SIZE_BUTTON_HEIGHT;
      case 'navHeight': return this.SIZE_NAV_HEIGHT;
      default: return this.SIZE_INPUT_HEIGHT;
    }
  }
  
  /**
   * è·å–åœ†è§’å€¼
   */
  private getRadius(type: 'sm' | 'md' | 'lg' | 'xl'): number {
    switch (type) {
      case 'sm': return this.RADIUS_SM;
      case 'md': return this.RADIUS_MD;
      case 'lg': return this.RADIUS_LG;
      case 'xl': return this.RADIUS_XL;
      default: return this.RADIUS_MD;
    }
  }

  onBackPress(): boolean | void {
    if (this.hasChanges) {
      this.showUnsavedChangesDialog();
      return true; // é˜»æ­¢é»˜è®¤è¿”å›è¡Œä¸º
    }
    return false; // å…è®¸æ­£å¸¸è¿”å›
  }

  /**
   * æ£€æŸ¥æ˜¯å¦æœ‰æœªä¿å­˜çš„æ›´æ”¹
   */
  private checkForChanges(): void {
    if (!this.originalProfile) {
      this.hasChanges = false;
      return;
    }

    this.hasChanges = (
      this.userName !== this.originalProfile.userName ||
      this.userSignature !== this.originalProfile.userSignature ||
      this.userAvatarType !== this.originalProfile.userAvatarType ||
      this.userAvatarValue !== this.originalProfile.userAvatarValue
    );
  }

  /**
   * éªŒè¯è¾“å…¥
   */
  private validateInput(): void {
    const validation = this.userProfileManager.validateProfileInput(this.userName, this.userSignature);
    this.validationErrors = validation.errors;
  }

  /**
   * ä¿å­˜ç”¨æˆ·èµ„æ–™
   */
  private async saveProfile(): Promise<void> {
    if (this.isSaving) return;

    try {
      this.isSaving = true;
      this.validateInput();

      if (this.validationErrors.length > 0) {
        Logger.warn('UserProfileEditPage', `è¾“å…¥éªŒè¯å¤±è´¥: ${this.validationErrors.join(', ')}`);
        return;
      }

      const updates: Partial<UserProfileData> = {
        userName: this.userName,
        userSignature: this.userSignature,
        userAvatarType: this.userAvatarType,
        userAvatarValue: this.userAvatarValue
      };

      const success = await this.userProfileManager.updateProfile(updates);
      
      if (success) {
        Logger.info('UserProfileEditPage', 'ç”¨æˆ·èµ„æ–™ä¿å­˜æˆåŠŸ');
        this.hasChanges = false;
        
        // æ˜¾ç¤ºä¿å­˜æˆåŠŸæç¤º
        AlertDialog.show({
          title: 'ä¿å­˜æˆåŠŸ',
          message: 'ä¸ªäººèµ„æ–™å·²æ›´æ–°',
          confirm: {
            value: 'ç¡®å®š',
            action: () => {
              router.back();
            }
          }
        });
      } else {
        Logger.error('UserProfileEditPage', 'ç”¨æˆ·èµ„æ–™ä¿å­˜å¤±è´¥');
        AlertDialog.show({
          title: 'ä¿å­˜å¤±è´¥',
          message: 'æ›´æ–°ä¸ªäººèµ„æ–™æ—¶å‘ç”Ÿé”™è¯¯ï¼Œè¯·é‡è¯•',
          confirm: {
            value: 'ç¡®å®š',
            action: () => {}
          }
        });
      }
    } catch (error) {
      Logger.error('UserProfileEditPage', `ä¿å­˜ç”¨æˆ·èµ„æ–™å¼‚å¸¸: ${error}`);
    } finally {
      this.isSaving = false;
    }
  }

  /**
   * æ˜¾ç¤ºæœªä¿å­˜æ›´æ”¹å¯¹è¯æ¡†
   */
  private showUnsavedChangesDialog(): void {
    AlertDialog.show({
      title: 'æœªä¿å­˜çš„æ›´æ”¹',
      message: 'æ‚¨æœ‰æœªä¿å­˜çš„æ›´æ”¹ï¼Œæ˜¯å¦è¦ä¿å­˜åç¦»å¼€ï¼Ÿ',
      primaryButton: {
        value: 'ä¸ä¿å­˜',
        fontColor: $r('app.color.text_secondary'),
        action: () => {
          router.back();
        }
      },
      secondaryButton: {
        value: 'ä¿å­˜',
        fontColor: $r('app.color.primary_color'),
        action: async () => {
          await this.saveProfile();
        }
      }
    });
  }

  build() {
    Column() {
      // é¡¶éƒ¨å¯¼èˆªæ 
      Column() {
        this.buildNavigationBar()
      }
      .margin({ top: this.statusBarHeight })

      // å†…å®¹åŒºåŸŸ
      Scroll() {
        Column() {
          // å¤´åƒç¼–è¾‘åŒºåŸŸ
          this.buildAvatarSection()

          // åŸºæœ¬ä¿¡æ¯ç¼–è¾‘åŒºåŸŸ
          this.buildBasicInfoSection()

          // éªŒè¯é”™è¯¯æç¤º
          if (this.validationErrors.length > 0) {
            this.buildValidationErrors()
          }

          // ä¿å­˜æŒ‰é’®
          this.buildSaveButton()
        }
        .width('100%')
        .padding({ 
          left: this.getResponsiveSpacing(this.getSpacing('lg')), 
          right: this.getResponsiveSpacing(this.getSpacing('lg')), 
          top: this.getResponsiveSpacing(this.getSpacing('lg')), 
          bottom: this.getResponsiveSpacing(this.getSpacing('xxxl')) 
        })
      }
      .layoutWeight(1)
    }
    .width('100%')
    .height('100%')
    .backgroundColor($r('app.color.background_color'))
  }

  @Builder
  buildNavigationBar() {
    Row() {
      Button('å–æ¶ˆ')
        .fontSize(15)
        .backgroundColor(Color.Transparent)
        .fontColor($r('app.color.primary_color'))
        .onClick(() => {
          if (this.hasChanges) {
            this.showUnsavedChangesDialog();
          } else {
            router.back();
          }
        })

      Text('ç¼–è¾‘ä¸ªäººèµ„æ–™')
        .fontSize(17)
        .fontColor($r('app.color.text_primary'))
        .fontWeight(FontWeight.Medium)
        .layoutWeight(1)
        .textAlign(TextAlign.Center)

      Button('å®Œæˆ')
        .fontSize(15)
        .backgroundColor(Color.Transparent)
        .fontColor(this.hasChanges && this.validationErrors.length === 0 ? $r('app.color.primary_color') : $r('app.color.text_secondary'))
        .enabled(this.hasChanges && this.validationErrors.length === 0 && !this.isSaving)
        .onClick(async () => {
          await this.saveProfile();
        })
    }
    .width('100%')
    .height(this.getSize('navHeight'))
    .padding({ left: this.getSpacing('lg'), right: this.getSpacing('lg') })
    .backgroundColor($r('app.color.surface_color'))
    .shadow({
      radius: 2,
      color: '#0D000000',
      offsetY: 1
    })
  }

  @Builder
  buildAvatarSection() {
    Column() {
      Text('å¤´åƒ')
        .fontSize(14)
        .fontColor($r('app.color.text_secondary'))
        .fontWeight(FontWeight.Medium)
        .width('100%')
        .margin({ bottom: this.getSpacing('md') })

      // å¤´åƒé¢„è§ˆå’Œç¼–è¾‘
      Column() {
        // å¤´åƒæ˜¾ç¤º
        Column() {
          this.buildAvatarPreview()
        }
        .margin({ bottom: this.getSpacing('md') })

        // æ›´æ¢å¤´åƒæŒ‰é’®
        Button('æ›´æ¢å¤´åƒ')
          .type(ButtonType.Normal)
          .fontSize(15)
          .fontColor($r('app.color.primary_color'))
          .backgroundColor($r('app.color.input_background'))
          .width(100)
          .height(this.getSize('buttonHeight') - 8)
          .borderRadius(this.getRadius('md'))
          .onClick(() => {
            this.showAvatarSelectionDialog();
          })
      }
      .width('100%')
      .padding({ 
        top: this.getSpacing('lg'), 
        bottom: this.getSpacing('lg'),
        left: this.getSpacing('lg'),
        right: this.getSpacing('lg')
      })
      .backgroundColor($r('app.color.surface_color'))
      .borderRadius(this.getRadius('lg'))
      .alignItems(HorizontalAlign.Center)
      .margin({ bottom: this.getSpacing('lg') })
    }
    .width('100%')
    .alignItems(HorizontalAlign.Start)
  }

  @Builder
  buildAvatarPreview() {
    if (this.userAvatarType === 'emoji') {
      Text(this.userAvatarValue)
        .fontSize(40)
        .width(this.getResponsiveSize(this.getSize('avatar')))
        .height(this.getResponsiveSize(this.getSize('avatar')))
        .textAlign(TextAlign.Center)
        .border({ 
          width: 2, 
          color: $r('app.color.border_color'), 
          radius: this.getSize('avatar') / 2 
        })
        .backgroundColor($r('app.color.surface_color'))
    } else if (this.userAvatarType === 'image') {
      Image(this.userAvatarValue)
        .width(this.getResponsiveSize(this.getSize('avatar')))
        .height(this.getResponsiveSize(this.getSize('avatar')))
        .borderRadius(this.getSize('avatar') / 2)
        .border({ width: 2, color: $r('app.color.border_color') })
        .objectFit(ImageFit.Cover)
        .onError(() => {
          Logger.warn('UserProfileEditPage', 'å¤´åƒå›¾ç‰‡åŠ è½½å¤±è´¥');
        })
    } else {
      Circle({ width: this.getSize('avatar'), height: this.getSize('avatar') })
        .fill(this.userAvatarValue)
        .border({ width: 2, color: $r('app.color.border_color') })
    }
  }

  @Builder
  buildBasicInfoSection() {
    Column() {
      // ç”¨æˆ·åç¼–è¾‘
      Column() {
        Text('ç”¨æˆ·å')
          .fontSize(14)
          .fontColor($r('app.color.text_secondary'))
          .fontWeight(FontWeight.Medium)
          .width('100%')
          .margin({ bottom: this.getSpacing('sm') })

        TextInput({ text: this.userName, placeholder: 'è¯·è¾“å…¥ç”¨æˆ·åï¼ˆ1-20å­—ç¬¦ï¼‰' })
          .width('100%')
          .height(this.getSize('inputHeight'))
          .fontSize(16)
          .backgroundColor($r('app.color.input_background'))
          .borderRadius(this.getRadius('md'))
          .padding({ left: this.getSpacing('lg'), right: this.getSpacing('lg') })
          .onChange((value: string) => {
            this.userName = value;
            this.checkForChanges();
            this.validateInput();
          })
          .maxLength(20)

        // å­—ç¬¦è®¡æ•°
        Text(`${this.userName.length}/20`)
          .fontSize(12)
          .fontColor($r('app.color.text_secondary'))
          .width('100%')
          .textAlign(TextAlign.End)
          .margin({ top: this.getSpacing('xs') })
      }
      .width('100%')
      .margin({ bottom: this.getSpacing('lg') })

      // ä¸ªæ€§ç­¾åç¼–è¾‘
      Column() {
        Text('ä¸ªæ€§ç­¾å')
          .fontSize(14)
          .fontColor($r('app.color.text_secondary'))
          .fontWeight(FontWeight.Medium)
          .width('100%')
          .margin({ bottom: this.getSpacing('sm') })

        TextArea({ text: this.userSignature, placeholder: 'å†™ç‚¹ä»€ä¹ˆä»‹ç»è‡ªå·±å§ï¼ˆæœ€å¤š50å­—ç¬¦ï¼‰' })
          .width('100%')
          .height(this.getSize('textAreaHeight'))
          .fontSize(16)
          .backgroundColor($r('app.color.input_background'))
          .borderRadius(this.getRadius('md'))
          .padding({ 
            left: this.getSpacing('lg'), 
            right: this.getSpacing('lg'), 
            top: this.getSpacing('md'), 
            bottom: this.getSpacing('md') 
          })
          .onChange((value: string) => {
            this.userSignature = value;
            this.checkForChanges();
            this.validateInput();
          })
          .maxLength(50)

        // å­—ç¬¦è®¡æ•°
        Text(`${this.userSignature.length}/50`)
          .fontSize(12)
          .fontColor($r('app.color.text_secondary'))
          .width('100%')
          .textAlign(TextAlign.End)
          .margin({ top: this.getSpacing('xs') })
      }
      .width('100%')
    }
    .width('100%')
    .padding({ 
      top: this.getSpacing('lg'), 
      bottom: this.getSpacing('lg'), 
      left: this.getSpacing('lg'), 
      right: this.getSpacing('lg') 
    })
    .backgroundColor($r('app.color.surface_color'))
    .borderRadius(this.getRadius('lg'))
    .margin({ bottom: this.getSpacing('lg') })
  }

  @Builder
  buildValidationErrors() {
    Column() {
      Row() {
        Text('âš ï¸')
          .fontSize(16)
          .margin({ right: this.getSpacing('sm') })
        
        Column() {
          ForEach(this.validationErrors, (error: string, index: number) => {
            Text(error)
              .fontSize(14)
              .fontColor('#D32F2F')
              .width('100%')
              .margin({ bottom: index < this.validationErrors.length - 1 ? this.getSpacing('xs') : 0 })
          })
        }
        .layoutWeight(1)
      }
      .width('100%')
      .alignItems(VerticalAlign.Top)
    }
    .width('100%')
    .padding({ 
      left: this.getResponsiveSpacing(this.getSpacing('lg')), 
      right: this.getResponsiveSpacing(this.getSpacing('lg')), 
      top: this.getResponsiveSpacing(this.getSpacing('md')), 
      bottom: this.getResponsiveSpacing(this.getSpacing('md')) 
    })
    .backgroundColor('#FFEBEE')
    .borderRadius(this.getRadius('md'))
    .border({ width: 1, color: '#FFCDD2' })
    .margin({ bottom: this.getResponsiveSpacing(this.getSpacing('lg')) })
  }

  @Builder
  buildSaveButton() {
    Button(this.isSaving ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜æ›´æ”¹')
      .type(ButtonType.Normal)
      .fontSize(16)
      .fontColor('#FFFFFF')
      .backgroundColor(this.hasChanges && this.validationErrors.length === 0 ? $r('app.color.primary_color') : $r('app.color.text_secondary'))
      .width('100%')
      .height(this.getSize('buttonHeight'))
      .borderRadius(this.getRadius('md'))
      .enabled(this.hasChanges && this.validationErrors.length === 0 && !this.isSaving)
      .margin({ top: this.getSpacing('lg') })
      .onClick(async () => {
        await this.saveProfile();
      })
  }

  /**
   * æ˜¾ç¤ºå¤´åƒé€‰æ‹©å¯¹è¯æ¡†
   */
  private showAvatarSelectionDialog(): void {
    const avatarOptions: AvatarOption[] = [
      { text: 'é»˜è®¤è“è‰²', value: 'default:#4285F4' },
      { text: 'é»˜è®¤ç»¿è‰²', value: 'default:#34A853' },
      { text: 'é»˜è®¤çº¢è‰²', value: 'default:#EA4335' },
      { text: 'é»˜è®¤æ©™è‰²', value: 'default:#FBBC05' },
      { text: 'é»˜è®¤ç´«è‰²', value: 'default:#9C27B0' },
      { text: 'ğŸ˜€', value: 'emoji:ğŸ˜€' },
      { text: 'ğŸ™‚', value: 'emoji:ğŸ™‚' },
      { text: 'ğŸ˜Š', value: 'emoji:ğŸ˜Š' },
      { text: 'ğŸ¤”', value: 'emoji:ğŸ¤”' },
      { text: 'ğŸ¤–', value: 'emoji:ğŸ¤–' },
      { text: 'ğŸ‘¨â€ğŸ’»', value: 'emoji:ğŸ‘¨â€ğŸ’»' },
      { text: 'ğŸ‘©â€ğŸ’»', value: 'emoji:ğŸ‘©â€ğŸ’»' },
      { text: 'é€‰æ‹©å›¾ç‰‡', value: 'image:select' }
    ];

    this.showAvatarGridDialog(avatarOptions);
  }

  /**
   * æ˜¾ç¤ºå¤´åƒç½‘æ ¼é€‰æ‹©å¯¹è¯æ¡†
   */
  private showAvatarGridDialog(options: AvatarOption[]): void {
    const optionTexts = options.map((opt: AvatarOption) => opt.text);
    
    TextPickerDialog.show({
      range: optionTexts,
      selected: 0,
      onAccept: async (value: TextPickerResult) => {
        const selectedIndex: number = value.index as number;
        const selectedOption = options[selectedIndex];
        
        if (selectedOption.value === 'image:select') {
          await this.selectImageFromGallery();
        } else {
          const parts = selectedOption.value.split(':');
          const type = parts[0] as 'default' | 'emoji';
          const val = parts[1];
          this.updateAvatarSetting(type, val);
        }
      },
      onCancel: () => {
        // å–æ¶ˆå¤´åƒé€‰æ‹©
      }
    });
  }

  /**
   * ä»ç›¸å†Œé€‰æ‹©å›¾ç‰‡
   */
  private async selectImageFromGallery(): Promise<void> {
    try {
      const photoSelectOptions: picker.PhotoSelectOptions = {
        MIMEType: picker.PhotoViewMIMETypes.IMAGE_TYPE,
        maxSelectNumber: 1
      };

      const photoPicker: picker.PhotoViewPicker = new picker.PhotoViewPicker();
      const photoSelectResult: picker.PhotoSelectResult = await photoPicker.select(photoSelectOptions);

      if (photoSelectResult.photoUris.length > 0) {
        const imageUri: string = photoSelectResult.photoUris[0];
        this.updateAvatarSetting('image', imageUri);
        Logger.info('UserProfileEditPage', 'å¤´åƒå›¾ç‰‡é€‰æ‹©æˆåŠŸ');
      }
    } catch (error) {
      Logger.error('UserProfileEditPage', `é€‰æ‹©å¤´åƒå›¾ç‰‡å¤±è´¥: ${error}`);
      AlertDialog.show({
        title: 'é€‰æ‹©å¤±è´¥',
        message: 'æ— æ³•é€‰æ‹©å›¾ç‰‡ï¼Œè¯·é‡è¯•',
        confirm: {
          value: 'ç¡®å®š',
          action: () => {}
        }
      });
    }
  }

  /**
   * æ›´æ–°å¤´åƒè®¾ç½®
   */
  private updateAvatarSetting(type: 'default' | 'emoji' | 'image', value: string): void {
    this.userAvatarType = type;
    this.userAvatarValue = value;
    this.checkForChanges();
    Logger.info('UserProfileEditPage', `å¤´åƒå·²æ›´æ–°: ${type} = ${value}`);
  }
}