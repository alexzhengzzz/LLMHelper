import { describe, beforeAll, afterAll, it, expect } from '@ohos/hypium';
import { hilog } from '@kit.PerformanceAnalysisKit';

/**
 * é¸¿è’™å®¢æˆ·ç«¯å®Œæ•´æµ‹è¯•å¥—ä»¶
 * å¯¼å…¥æ‰€æœ‰æµ‹è¯•æ¨¡å—å¹¶æ‰§è¡Œ
 */

// å¯¼å…¥æµ‹è¯•å·¥å…·ç±»
import { TestUtils } from './TestUtils';

// å¯¼å…¥æ ¸å¿ƒæœåŠ¡æµ‹è¯•
import apiManagerTest from './APIManagerTest';
import webSocketServiceTest from './WebSocketServiceTest';
import speechServiceTest from './SpeechServiceTest';
import apiServiceTest from './ApiServiceTest';
import deepThinkingServiceTest from './DeepThinkingServiceTest';
import hybridChatServiceTest from './HybridChatServiceTest';

// å¯¼å…¥æ•°æ®å­˜å‚¨æµ‹è¯•
import appStorageTest from './AppStorageTest';
import sessionManagerTest from './SessionManagerTest';

// å¯¼å…¥UIç»„ä»¶æµ‹è¯•
import modelSelectorComponentTest from './ModelSelectorComponentTest';
import voiceInputComponentTest from './VoiceInputComponentTest';
import smartTextRendererTest from './SmartTextRendererTest';
import deepThinkingDialogTest from './DeepThinkingDialogTest';

// å¯¼å…¥å·¥å…·ç±»æµ‹è¯•
import themeManagerTest from './ThemeManagerTest';
import systemPromptManagerTest from './SystemPromptManagerTest';

/**
 * ä¸»æµ‹è¯•å¥—ä»¶
 */
export default function testsuite() {
  describe('é¸¿è’™å®¢æˆ·ç«¯å®Œæ•´æµ‹è¯•å¥—ä»¶', () => {
    
    beforeAll(() => {
      TestUtils.log('ğŸš€ å¼€å§‹æ‰§è¡Œé¸¿è’™å®¢æˆ·ç«¯å®Œæ•´æµ‹è¯•å¥—ä»¶');
    });
    
    afterAll(() => {
      TestUtils.log('âœ… é¸¿è’™å®¢æˆ·ç«¯å®Œæ•´æµ‹è¯•å¥—ä»¶æ‰§è¡Œå®Œæˆ');
    });
    
    // æ‰§è¡Œæ ¸å¿ƒæœåŠ¡æµ‹è¯•
    TestUtils.log('ğŸ“¦ æ‰§è¡Œæ ¸å¿ƒæœåŠ¡æµ‹è¯•...');
    apiManagerTest();
    webSocketServiceTest();
    speechServiceTest();
    apiServiceTest();
    deepThinkingServiceTest();
    hybridChatServiceTest();
    
    // æ‰§è¡Œæ•°æ®å­˜å‚¨æµ‹è¯•
    TestUtils.log('ğŸ’¾ æ‰§è¡Œæ•°æ®å­˜å‚¨æµ‹è¯•...');
    appStorageTest();
    sessionManagerTest();
    
    // æ‰§è¡ŒUIç»„ä»¶æµ‹è¯•
    TestUtils.log('ğŸ¨ æ‰§è¡ŒUIç»„ä»¶æµ‹è¯•...');
    modelSelectorComponentTest();
    voiceInputComponentTest();
    smartTextRendererTest();
    deepThinkingDialogTest();
    
    // æ‰§è¡Œå·¥å…·ç±»æµ‹è¯•
    TestUtils.log('ğŸ› ï¸ æ‰§è¡Œå·¥å…·ç±»æµ‹è¯•...');
    themeManagerTest();
    systemPromptManagerTest();
  });
}

/**
 * æµ‹è¯•å¥—ä»¶ä¿¡æ¯
 */
export const TestSuiteInfo = {
  name: 'é¸¿è’™å®¢æˆ·ç«¯å®Œæ•´æµ‹è¯•å¥—ä»¶',
  version: '1.0.0',
  description: 'Javis AIç¼–ç¨‹åŠ©æ‰‹é¸¿è’™å®¢æˆ·ç«¯çš„å®Œæ•´æµ‹è¯•è¦†ç›–',
  testModules: [
    {
      name: 'APIManagerTest',
      category: 'æ ¸å¿ƒæœåŠ¡',
      description: 'APIç®¡ç†å™¨åŠŸèƒ½æµ‹è¯•'
    },
    {
      name: 'WebSocketServiceTest',
      category: 'æ ¸å¿ƒæœåŠ¡',
      description: 'WebSocketæœåŠ¡åŠŸèƒ½æµ‹è¯•'
    },
    {
      name: 'SpeechServiceTest',
      category: 'æ ¸å¿ƒæœåŠ¡',
      description: 'è¯­éŸ³è¯†åˆ«å’ŒTTSæœåŠ¡æµ‹è¯•'
    },
    {
      name: 'ApiServiceTest',
      category: 'æ ¸å¿ƒæœåŠ¡',
      description: 'åŸºç¡€APIæœåŠ¡åŠŸèƒ½æµ‹è¯•'
    },
    {
      name: 'DeepThinkingServiceTest',
      category: 'æ ¸å¿ƒæœåŠ¡',
      description: 'æ·±åº¦æ€è€ƒæœåŠ¡åŠŸèƒ½æµ‹è¯•'
    },
    {
      name: 'HybridChatServiceTest',
      category: 'æ ¸å¿ƒæœåŠ¡',
      description: 'æ··åˆèŠå¤©æœåŠ¡åŠŸèƒ½æµ‹è¯•'
    },
    {
      name: 'AppStorageTest',
      category: 'æ•°æ®å­˜å‚¨',
      description: 'åº”ç”¨æ•°æ®å­˜å‚¨ç®¡ç†æµ‹è¯•'
    },
    {
      name: 'SessionManagerTest',
      category: 'æ•°æ®å­˜å‚¨',
      description: 'ä¼šè¯ç®¡ç†åŠŸèƒ½æµ‹è¯•'
    },
    {
      name: 'ModelSelectorComponentTest',
      category: 'UIç»„ä»¶',
      description: 'æ¨¡å‹é€‰æ‹©å™¨ç»„ä»¶æµ‹è¯•'
    },
    {
      name: 'VoiceInputComponentTest',
      category: 'UIç»„ä»¶',
      description: 'è¯­éŸ³è¾“å…¥ç»„ä»¶æµ‹è¯•'
    },
    {
      name: 'SmartTextRendererTest',
      category: 'UIç»„ä»¶',
      description: 'æ™ºèƒ½æ–‡æœ¬æ¸²æŸ“å™¨æµ‹è¯•'
    },
    {
      name: 'DeepThinkingDialogTest',
      category: 'UIç»„ä»¶',
      description: 'æ·±åº¦æ€è€ƒå¯¹è¯æ¡†æµ‹è¯•'
    },
    {
      name: 'ThemeManagerTest',
      category: 'å·¥å…·ç±»',
      description: 'ä¸»é¢˜ç®¡ç†å™¨æµ‹è¯•'
    },
    {
      name: 'SystemPromptManagerTest',
      category: 'å·¥å…·ç±»',
      description: 'ç³»ç»Ÿæç¤ºè¯ç®¡ç†å™¨æµ‹è¯•'
    }
  ],
  totalTestCases: 0, // å°†åœ¨è¿è¡Œæ—¶ç»Ÿè®¡
  estimatedDuration: '5-8åˆ†é’Ÿ'
};

/**
 * æµ‹è¯•ç»Ÿè®¡ä¿¡æ¯
 */
export const TestStatistics = {
  totalTests: 0,
  passedTests: 0,
  failedTests: 0,
  skippedTests: 0,
  startTime: 0,
  endTime: 0,
  duration: 0,
  
  start(): void {
    this.startTime = Date.now();
    TestUtils.log('ğŸ“Š æµ‹è¯•ç»Ÿè®¡å¼€å§‹è®¡æ—¶');
  },
  
  end(): void {
    this.endTime = Date.now();
    this.duration = this.endTime - this.startTime;
    TestUtils.log(`ğŸ“Š æµ‹è¯•æ‰§è¡Œå®Œæˆï¼Œè€—æ—¶: ${this.duration}ms`);
  },
  
  getSummary(): string {
    return `
ğŸ“‹ æµ‹è¯•æ‰§è¡Œæ‘˜è¦
================================
æ€»æµ‹è¯•æ•°: ${this.totalTests}
é€šè¿‡æµ‹è¯•: ${this.passedTests}
å¤±è´¥æµ‹è¯•: ${this.failedTests}
è·³è¿‡æµ‹è¯•: ${this.skippedTests}
æ‰§è¡Œæ—¶é—´: ${this.duration}ms
æˆåŠŸç‡: ${this.totalTests > 0 ? ((this.passedTests / this.totalTests) * 100).toFixed(2) : 0}%
================================`;
  }
};

/**
 * æµ‹è¯•ç¯å¢ƒæ£€æŸ¥
 */
export const TestEnvironment = {
  checkEnvironment(): boolean {
    TestUtils.log('ğŸ” æ£€æŸ¥æµ‹è¯•ç¯å¢ƒ...');
    
    try {
      // æ£€æŸ¥å¿…è¦çš„å…¨å±€å¯¹è±¡å’Œæ¨¡å—
      if (typeof describe === 'undefined') {
        TestUtils.error('æµ‹è¯•æ¡†æ¶æœªæ­£ç¡®åˆå§‹åŒ–ï¼šdescribeå‡½æ•°ä¸å­˜åœ¨');
        return false;
      }
      
      if (typeof it === 'undefined') {
        TestUtils.error('æµ‹è¯•æ¡†æ¶æœªæ­£ç¡®åˆå§‹åŒ–ï¼šitå‡½æ•°ä¸å­˜åœ¨');
        return false;
      }
      
      if (typeof expect === 'undefined') {
        TestUtils.error('æµ‹è¯•æ¡†æ¶æœªæ­£ç¡®åˆå§‹åŒ–ï¼šexpectå‡½æ•°ä¸å­˜åœ¨');
        return false;
      }
      
      // æ£€æŸ¥HarmonyOSç‰¹å®šAPI
      if (typeof hilog === 'undefined') {
        TestUtils.warn('hilogæ¨¡å—ä¸å¯ç”¨ï¼Œå°†ä½¿ç”¨consoleæ›¿ä»£');
      }
      
      TestUtils.log('âœ… æµ‹è¯•ç¯å¢ƒæ£€æŸ¥é€šè¿‡');
      return true;
    } catch (error) {
      TestUtils.error(`æµ‹è¯•ç¯å¢ƒæ£€æŸ¥å¤±è´¥: ${error}`);
      return false;
    }
  },
  
  getSystemInfo(): string {
    return `
ğŸ–¥ï¸  ç³»ç»Ÿä¿¡æ¯
================================
æµ‹è¯•å¹³å°: HarmonyOS
æµ‹è¯•æ¡†æ¶: @ohos/hypium
æµ‹è¯•æ—¶é—´: ${new Date().toISOString()}
Node.jsç‰ˆæœ¬: N/A
================================`;
  }
};